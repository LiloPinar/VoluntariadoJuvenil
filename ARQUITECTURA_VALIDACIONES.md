# üìö Organizaci√≥n de Validaciones y L√≥gica de Formularios

## üéØ Objetivo
Separar toda la l√≥gica de validaci√≥n de formularios de los componentes TSX para que el c√≥digo sea **limpio, corto y mantenible**.

## üìÇ Estructura de Carpetas

```
src/
‚îú‚îÄ‚îÄ validations/               # ‚úÖ Funciones puras de validaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ index.ts              # Exportaciones centralizadas
‚îÇ   ‚îú‚îÄ‚îÄ authValidations.ts    # Validaciones de autenticaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ formValidations.ts    # Validaciones gen√©ricas
‚îÇ   ‚îî‚îÄ‚îÄ README.md             # Documentaci√≥n
‚îÇ
‚îú‚îÄ‚îÄ hooks/                     # ‚úÖ Custom hooks para l√≥gica de formularios
‚îÇ   ‚îú‚îÄ‚îÄ useAuth.tsx           # Autenticaci√≥n y bloqueo de seguridad
‚îÇ   ‚îú‚îÄ‚îÄ useLoginForm.tsx      # L√≥gica completa del formulario de login
‚îÇ   ‚îú‚îÄ‚îÄ useRegisterForm.tsx   # L√≥gica completa del formulario de registro
‚îÇ   ‚îú‚îÄ‚îÄ useForgotPasswordForm.tsx  # L√≥gica de recuperar contrase√±a
‚îÇ   ‚îî‚îÄ‚îÄ useProfileForm.tsx    # L√≥gica de perfil (ver/editar)
‚îÇ
‚îî‚îÄ‚îÄ pages/                     # ‚úÖ Componentes UI minimalistas
    ‚îú‚îÄ‚îÄ Login.tsx             # Solo UI + useLoginForm
    ‚îú‚îÄ‚îÄ Register.tsx          # Solo UI + useRegisterForm
    ‚îú‚îÄ‚îÄ ForgotPassword.tsx    # Solo UI + useForgotPasswordForm
    ‚îî‚îÄ‚îÄ Profile.tsx           # Solo UI + useProfileForm
```

---

## üîß C√≥mo Funciona

### 1Ô∏è‚É£ Validaciones (src/validations/)
**Funciones puras** que solo validan y retornan mensajes de error.

```typescript
// src/validations/authValidations.ts
export const validateEmail = (email: string, t: (key: string) => string) => {
  if (!email.trim()) return t('field_required');
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) return t('invalid_email');
  return undefined; // Sin error
};
```

**‚úÖ Ventajas:**
- Sin estado (stateless)
- F√°cil de testear
- Reutilizables en cualquier formulario
- Solo 1 responsabilidad: validar

---

### 2Ô∏è‚É£ Custom Hooks (src/hooks/)
**L√≥gica de estado** del formulario: valores, errores, touched, handlers.

```typescript
// src/hooks/useLoginForm.tsx
export const useLoginForm = (initialEmail: string = '') => {
  const [formData, setFormData] = useState({ email: '', password: '', rememberMe: false });
  const [errors, setErrors] = useState({});
  const [touched, setTouched] = useState({});

  const handleChange = (field, value, t) => {
    setFormData(prev => ({ ...prev, [field]: value }));
    if (touched[field]) {
      const error = validateField(field, value, t);
      setErrors(prev => ({ ...prev, [field]: error }));
    }
  };

  const validateAll = (t) => {
    // Validar todos los campos
    return !hasErrors;
  };

  return { formData, errors, touched, handleChange, handleBlur, validateAll };
};
```

**‚úÖ Ventajas:**
- Encapsula TODA la l√≥gica del formulario
- Estado + validaciones + handlers en un solo lugar
- Componente TSX queda s√∫per simple

---

### 3Ô∏è‚É£ Componentes (src/pages/)
**Solo UI + llamadas al hook**. MUY corto y legible.

```typescript
// src/pages/Login.tsx (VERSI√ìN SIMPLIFICADA)
import { useLoginForm } from '@/hooks/useLoginForm';
import { useAuth } from '@/hooks/useAuth';

const Login = () => {
  const { t } = useLocale();
  const { formData, errors, touched, handleChange, handleBlur, validateAll } = useLoginForm();
  const { login } = useAuth();
  const [isLoading, setIsLoading] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!validateAll(t)) return;
    
    setIsLoading(true);
    const result = await login(formData.email, formData.password, formData.rememberMe);
    setIsLoading(false);
    // Manejar resultado...
  };

  return (
    <form onSubmit={handleSubmit}>
      <Input
        value={formData.email}
        onChange={(e) => handleChange('email', e.target.value, t)}
        onBlur={() => handleBlur('email', t)}
      />
      {errors.email && <p>{errors.email}</p>}
      {/* ...resto de campos... */}
    </form>
  );
};
```

**‚úÖ Ventajas:**
- Componente de ~50-80 l√≠neas (vs 300-400 antes)
- F√°cil de leer y entender
- Solo se preocupa de renderizar UI
- Testeable f√°cilmente

---

## üìä Comparaci√≥n: Antes vs Despu√©s

### ‚ùå ANTES (C√≥digo en el componente)
```typescript
// Login.tsx - 359 l√≠neas

const Login = () => {
  // 10 useState diferentes
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [errors, setErrors] = useState({});
  const [touched, setTouched] = useState({});
  // ...
  
  // 50+ l√≠neas de handlers
  const handleEmailChange = (e) => {
    const value = e.target.value;
    setEmail(value);
    if (touched.email) {
      if (!value.trim()) setErrors(prev => ({ ...prev, email: 'Required' }));
      if (!/regex/.test(value)) setErrors(prev => ({ ...prev, email: 'Invalid' }));
    }
  };
  
  const handlePasswordChange = (e) => { /* ... */ };
  const handleBlur = (field) => { /* ... */ };
  const handleSubmit = (e) => { /* 30 l√≠neas */ };
  
  // 200+ l√≠neas de JSX
  return <div>...</div>;
};
```

### ‚úÖ DESPU√âS (Separado)
```typescript
// useLoginForm.tsx - 80 l√≠neas (hook reutilizable)
export const useLoginForm = () => {
  // Todo el estado y l√≥gica aqu√≠
  return { formData, errors, touched, handleChange, handleBlur, validateAll };
};

// Login.tsx - 120 l√≠neas (solo UI)
const Login = () => {
  const { formData, errors, touched, handleChange, handleBlur, validateAll } = useLoginForm();
  const handleSubmit = async (e) => { /* 15 l√≠neas */ };
  return <form>...</form>; // Solo JSX
};
```

---

## üé® Flujo de Datos

```
Usuario tipea
    ‚Üì
handleChange('email', value, t)
    ‚Üì
Hook actualiza formData
    ‚Üì
Si touched, ejecuta validateEmail(value, t)
    ‚Üì
Actualiza errors
    ‚Üì
Componente re-renderiza con nuevo error
```

---

## üìù Ejemplo Completo: Login Simplificado

### Archivo: `src/hooks/useLoginForm.tsx` (80 l√≠neas)
```typescript
import { useState, useEffect } from 'react';
import { validateEmail, validatePassword } from '@/validations';

export const useLoginForm = (initialEmail = '') => {
  const [formData, setFormData] = useState({
    email: initialEmail,
    password: '',
    rememberMe: !!initialEmail,
  });
  const [errors, setErrors] = useState({});
  const [touched, setTouched] = useState({});

  useEffect(() => {
    if (initialEmail) setFormData(prev => ({ ...prev, email: initialEmail, rememberMe: true }));
  }, [initialEmail]);

  const validateField = (field, value, t) => {
    if (field === 'email') return validateEmail(value, t);
    if (field === 'password') return validatePassword(value, t);
  };

  const handleChange = (field, value, t) => {
    setFormData(prev => ({ ...prev, [field]: value }));
    if (touched[field]) {
      const error = validateField(field, value, t);
      setErrors(prev => ({ ...prev, [field]: error }));
    }
  };

  const handleBlur = (field, t) => {
    setTouched(prev => ({ ...prev, [field]: true }));
    const value = formData[field];
    const error = validateField(field, value, t);
    setErrors(prev => ({ ...prev, [field]: error }));
  };

  const validateAll = (t) => {
    const emailError = validateEmail(formData.email, t);
    const passwordError = validatePassword(formData.password, t);
    setErrors({ email: emailError, password: passwordError });
    setTouched({ email: true, password: true });
    return !emailError && !passwordError;
  };

  return { formData, errors, touched, handleChange, handleBlur, validateAll };
};
```

### Archivo: `src/pages/Login.tsx` (120 l√≠neas)
```typescript
import { useState } from 'react';
import { useLoginForm } from '@/hooks/useLoginForm';
import { useAuth } from '@/hooks/useAuth';
// ... imports de UI

const Login = () => {
  const { t } = useLocale();
  const navigate = useNavigate();
  const { toast } = useToast();
  const { rememberedEmail, isLocked, login } = useAuth();
  const { formData, errors, touched, handleChange, handleBlur, validateAll } = useLoginForm(rememberedEmail);
  const [showPassword, setShowPassword] = useState(false);
  const [isLoading, setIsLoading] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!validateAll(t)) {
      toast({ title: "Error", description: "Corrige los errores", variant: "destructive" });
      return;
    }

    setIsLoading(true);
    const result = await login(formData.email, formData.password, formData.rememberMe);
    setIsLoading(false);
    
    if (result.success) {
      toast({ title: "√âxito", description: "Bienvenido" });
      navigate('/');
    } else {
      toast({ title: "Error", description: result.message, variant: "destructive" });
    }
  };

  return (
    <div>
      <Header />
      <form onSubmit={handleSubmit}>
        <Input
          value={formData.email}
          onChange={(e) => handleChange('email', e.target.value, t)}
          onBlur={() => handleBlur('email', t)}
        />
        {errors.email && <p>{errors.email}</p>}
        
        <Input
          type={showPassword ? 'text' : 'password'}
          value={formData.password}
          onChange={(e) => handleChange('password', e.target.value, t)}
          onBlur={() => handleBlur('password', t)}
        />
        {errors.password && <p>{errors.password}</p>}
        
        <Checkbox
          checked={formData.rememberMe}
          onCheckedChange={(checked) => handleChange('rememberMe', checked, t)}
        />
        
        <Button type="submit" disabled={isLoading || isLocked}>
          {isLoading ? 'Cargando...' : 'Iniciar Sesi√≥n'}
        </Button>
      </form>
      <Footer />
    </div>
  );
};
```

---

## üìà Beneficios

| M√©trica | Antes | Despu√©s | Mejora |
|---------|-------|---------|--------|
| **L√≠neas en componente** | 300-400 | 100-150 | ‚úÖ 60% menos |
| **Responsabilidades** | UI + Estado + Validaci√≥n | Solo UI | ‚úÖ Separaci√≥n clara |
| **Reutilizaci√≥n** | 0% | 100% | ‚úÖ Hook reutilizable |
| **Testabilidad** | Dif√≠cil | F√°cil | ‚úÖ Funciones puras |
| **Mantenibilidad** | Baja | Alta | ‚úÖ C√≥digo modular |

---

## üöÄ Archivos Creados

```
‚úÖ src/validations/authValidations.ts    (6 funciones)
‚úÖ src/validations/formValidations.ts    (11 funciones)
‚úÖ src/validations/index.ts              (exportaciones)
‚úÖ src/hooks/useAuth.tsx                 (seguridad + bloqueo)
‚úÖ src/hooks/useLoginForm.tsx            (l√≥gica login)
‚úÖ src/hooks/useRegisterForm.tsx         (l√≥gica register)
‚úÖ src/hooks/useForgotPasswordForm.tsx   (l√≥gica recuperar)
‚úÖ src/hooks/useProfileForm.tsx          (l√≥gica perfil)
```

**Total:** 8 archivos nuevos que simplifican 4 componentes principales.

---

## üí° Conclusi√≥n

Con esta arquitectura:
- **Componentes:** Solo se preocupan de renderizar UI (50-150 l√≠neas)
- **Hooks:** Manejan todo el estado y l√≥gica (80-120 l√≠neas cada uno)
- **Validaciones:** Funciones puras reutilizables (10-20 l√≠neas cada una)

**Resultado:** C√≥digo limpio, mantenible, testeable y profesional. üéâ
